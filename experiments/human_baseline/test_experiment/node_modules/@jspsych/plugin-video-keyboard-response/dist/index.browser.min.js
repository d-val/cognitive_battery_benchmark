var jsPsychVideoKeyboardResponse=function(e){"use strict";function t(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var s={name:"video-keyboard-response",parameters:{stimulus:{type:e.ParameterType.VIDEO,pretty_name:"Video",default:void 0,array:!0},choices:{type:e.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},width:{type:e.ParameterType.INT,pretty_name:"Width",default:""},height:{type:e.ParameterType.INT,pretty_name:"Height",default:""},autoplay:{type:e.ParameterType.BOOL,pretty_name:"Autoplay",default:!0},controls:{type:e.ParameterType.BOOL,pretty_name:"Controls",default:!1},start:{type:e.ParameterType.FLOAT,pretty_name:"Start",default:null},stop:{type:e.ParameterType.FLOAT,pretty_name:"Stop",default:null},rate:{type:e.ParameterType.FLOAT,pretty_name:"Rate",default:1},trial_ends_after_video:{type:e.ParameterType.BOOL,pretty_name:"End trial after video finishes",default:!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0}}},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var s,a,r;return s=e,a=[{key:"trial",value:function(e,t){var s=this;if(!Array.isArray(t.stimulus))throw new Error("\n        The stimulus property for the video-keyboard-response plugin must be an array\n        of files. See https://www.jspsych.org/latest/plugins/video-keyboard-response/#parameters\n      ");var a="<div>";a+='<video id="jspsych-video-keyboard-response-stimulus"',t.width&&(a+=' width="'+t.width+'"'),t.height&&(a+=' height="'+t.height+'"'),t.autoplay&&null==t.start&&(a+=" autoplay "),t.controls&&(a+=" controls "),null!==t.start&&(a+=' style="visibility: hidden;"'),a+=">";var r=this.jsPsych.pluginAPI.getVideoBuffer(t.stimulus[0]);if(!r)for(var i=0;i<t.stimulus.length;i++){var n=t.stimulus[i];n.indexOf("?")>-1&&(n=n.substring(0,n.indexOf("?")));var l=n.substr(n.lastIndexOf(".")+1);"mov"==(l=l.toLowerCase())&&console.warn("Warning: video-keyboard-response plugin does not reliably support .mov files."),a+='<source src="'+n+'" type="video/'+l+'">'}a+="</video>",a+="</div>",null!==t.prompt&&(a+=t.prompt),e.innerHTML=a;var o=e.querySelector("#jspsych-video-keyboard-response-stimulus");r&&(o.src=r),o.onended=function(){t.trial_ends_after_video&&y(),0!=t.response_allowed_while_playing||t.trial_ends_after_video||s.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1})},o.playbackRate=t.rate,null!==t.start&&(o.pause(),o.onseeked=function(){o.style.visibility="visible",o.muted=!1,t.autoplay?o.play():o.pause(),o.onseeked=function(){}},o.onplaying=function(){o.currentTime=t.start,o.onplaying=function(){}},o.muted=!0,o.play());var u=!1;null!==t.stop&&o.addEventListener("timeupdate",(function(e){o.currentTime>=t.stop&&(t.response_allowed_while_playing||s.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1}),o.pause(),t.trial_ends_after_video&&!u&&(u=!0,y()))}));var p={rt:null,key:null},y=function(){s.jsPsych.pluginAPI.clearAllTimeouts(),s.jsPsych.pluginAPI.cancelAllKeyboardResponses(),e.querySelector("#jspsych-video-keyboard-response-stimulus").pause(),e.querySelector("#jspsych-video-keyboard-response-stimulus").onended=function(){};var a={rt:p.rt,stimulus:t.stimulus,response:p.key};e.innerHTML="",s.jsPsych.finishTrial(a)},d=function(s){e.querySelector("#jspsych-video-keyboard-response-stimulus").className+=" responded",null==p.key&&(p=s),t.response_ends_trial&&y()};"NO_KEYS"!=t.choices&&t.response_allowed_while_playing&&this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1}),null!==t.trial_duration&&this.jsPsych.pluginAPI.setTimeout(y,t.trial_duration)}},{key:"simulate",value:function(e,t,s,a){"data-only"==t&&(a(),this.simulate_data_only(e,s)),"visual"==t&&this.simulate_visual(e,s,a)}},{key:"simulate_data_only",value:function(e,t){var s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}},{key:"simulate_visual",value:function(e,t,s){var a=this,r=this.create_simulation_data(e,t),i=this.jsPsych.getDisplayElement();this.trial(i,e),s();var n=i.querySelector("#jspsych-video-button-response-stimulus"),l=function(){null!==r.rt&&a.jsPsych.pluginAPI.pressKey(r.response,r.rt)};e.response_allowed_while_playing?l():n.addEventListener("ended",l)}},{key:"create_simulation_data",value:function(e,t){var s={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(e.choices)},a=this.jsPsych.pluginAPI.mergeSimulationData(s,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,a),a}}],a&&t(s.prototype,a),r&&t(s,r),Object.defineProperty(s,"prototype",{writable:!1}),e}();return a.info=s,a}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
